<div class="flex w-full min-h-screen p-10">
  <div class="w-4/5 flex flex-col space-y-8 text-[#EEEEEE]">

    <div class="flex flex-row h-1/2 space-x-8">
      <div class="flex flex-col w-1/2 space-y-8">
        <div class="flex flex-col items-center space-y-4 p-4">
          <!-- Nuova sezione con immagine profilo -->
          <div class="text-center mb-6">
            <% if current_user.profile_image.attached? %>
              <%= image_tag current_user.profile_image_thumbnail, class: "rounded-full mx-auto shadow-xl w-40 h-40 object-cover border-4 border-white" %>
            <% else %>
              <%= image_tag('profile-placeholder.png', alt: 'Profile Image', class: 'rounded-full mx-auto shadow-xl w-40 h-40 object-cover') %>
            <% end %>
          </div>
          <div class="text-center">
            <h2 class="text-2xl font-bold text-[#EEEEEE]">Player: <%= @player.username %></h2>
          </div>
        </div>
      </div>
      <div class="flex flex-col w-1/2 space-y-2 px-4">
        <h2 class="text-2xl font-semibold text-[#EEEEEE]">Your Recent Games</h2>
      </div>
    </div>

    <div class="flex flex-col space-y-2 px-4">
      <h2 class="text-2xl font-semibold text-[#EEEEEE]">Leaderboard</h2>
      <div class="border-t-2 border-white mt-2 w-full"></div>
    </div>
  </div>

  <div class="border-l-2 border-white h-full mt-4"></div>

  <div class="w-1/5 p-6 flex flex-col space-y-6 justify-start">
    <div class="flex flex-col space-y-2">
      <%= form_with url: play_now_path, method: :get, local: true, html: { id: 'language-form' } do %>
        <%= select_tag :language, options_for_select(@languages.map { |language| [language, language.downcase] }, selected: @selected_language),
                       class: "w-full px-4 py-2 rounded border border-white text-white bg-transparent focus:border-white focus:ring-0",
                       onchange: "this.form.submit();" %>
      <% end %>
    </div>

    <%= form_with url: find_opponent_path, method: :post, local: true do |form| %>
      <%= hidden_field_tag :language, @selected_language, id: 'language_field' %>
      <%= button_tag(type: 'submit', class: "relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900") do %>
        <svg class="h-6 w-6 text-white-500 mr-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z"/>
          <polyline points="7 8 3 12 7 16" />
          <polyline points="17 8 21 12 17 16" />
          <line x1="14" y1="4" x2="10" y2="20" />
        </svg>
        Find Opponent
      <% end %>
    <% end %>

    <section>
      <button onclick="openChallengeModal()" class="relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900">Challenge a Friend</button>
    </section>

    <section>
      <button onclick="openModal()" class="relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900">Cerca Amici</button>
    </section>

    <div>
      <%= link_to 'Crea Sfida', new_challenge_path, class: 'relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900' %>
    </div>

    <div>
      <% if @current_user && @current_user.admin? %>
        <%= link_to 'Vai al Profilo Admin', admin_profile_path, class: 'relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900' %>
      <% end %>
      <%= link_to 'Vai al Profilo Utente', personal_profile_path, class: 'relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900' %>
    </div>

    <div>
      <%= link_to 'Visualizza Tabelle DB', database_info_path, class: 'relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900' %>
    </div>

    <div>
      <%= button_to 'Logout', 'auth/logout', method: :get, data: { turbo: false }, class: 'relative inline-flex items-center justify-center w-64 h-12 px-6 py-3 overflow-hidden font-bold rounded-full group bg-transparent text-white border-2 border-white hover:bg-white hover:text-gray-900' %>
    </div>

  </div>
</div>

<div id="challengeModal" class="fixed z-10 inset-0 overflow-y-auto hidden">
  <div class="flex items-center justify-center min-h-screen px-4">
    <div class="bg-gray-800 rounded-lg px-6 pt-6 pb-6 text-left overflow-hidden shadow-xl transform transition-all w-full max-w-xl">
      <div>
        <h3 class="text-2xl leading-6 font-bold text-gray-900 mb-4">Sfida un Amico</h3>
        <ul id="friendList" class="mt-4 max-h-72 overflow-y-auto border border-gray-300 rounded-lg">
          <% current_user.friends.each do |friend| %>
            <li class="flex items-center justify-between p-4 border-b border-gray-200">
              <%= form_with url: challenge_requests_path, method: :post do %>
                <%= link_to friend.username, user_profile_path(friend), class: 'friend-name text-lg text-gray-700 hover:underline' %>
                <%= hidden_field_tag :friend_id, friend.id %>  <!-- Assicurati di avere il friend_id corretto qui -->
                <%= submit_tag 'Sfida', class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full' %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
      <div class="mt-6 text-right">
        <button onclick="closeChallengeModal()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full">Chiudi</button>
      </div>
    </div>
  </div>
</div>

<div id="searchFriendsModal" class="fixed z-10 inset-0 overflow-y-auto hidden">
  <div class="flex items-center justify-center min-h-screen px-4">
    <div class="bg-white rounded-lg px-6 pt-6 pb-6 text-left overflow-hidden shadow-xl transform transition-all w-full max-w-xl">
      <div>
        <h3 class="text-2xl leading-6 font-bold text-gray-900 mb-4">Cerca Amici</h3>
        <input type="text" id="friendSearchInput" onkeyup="filterFriends()" placeholder="Cerca per username..." class="mt-3 p-3 border border-gray-300 rounded-lg w-full text-lg text-gray-700">

        <!-- Lista degli amici -->
        <ul id="friendList" class="mt-4 max-h-72 overflow-y-auto border border-gray-300 rounded-lg">
          <% available_friends = User.where.not(id: @current_user.id).where.not(id: @current_user.friends.ids) %>
          <% available_friends.each do |user| %>
            <li class="flex items-center justify-between p-4 border-b border-gray-200">
              <%= link_to user.username, user_profile_path(user), class: 'friend-name text-lg text-gray-700 hover:underline' %>
              <%= button_to 'Richiedi Amicizia', friend_requests_path(user_id: user.id), method: :post, class: 'bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full' %>
            </li>
          <% end %>
        </ul>
      </div>
      <div class="mt-6 text-right">
        <button onclick="closeModal()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full">Chiudi</button>
      </div>
    </div>
  </div>
</div>

<div class="play-now">
  <div id="waiting_modal"></div>
</div>

<script>
    function openModal() {
        document.getElementById('searchFriendsModal').classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('searchFriendsModal').classList.add('hidden');
    }

    function openChallengeModal() {
        document.getElementById('challengeModal').classList.remove('hidden');
    }

    function closeChallengeModal() {
        document.getElementById('challengeModal').classList.add('hidden');
    }

    function filterFriends() {
        let input = document.getElementById('friendSearchInput');
        let filter = input.value.toLowerCase();
        let ul = document.getElementById('friendList');
        let li = ul.getElementsByTagName('li');

        for (let i = 0; i < li.length; i++) {
            let friendName = li[i].getElementsByClassName('friend-name')[0];
            if (friendName.innerHTML.toLowerCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }
</script>
